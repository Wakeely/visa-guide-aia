<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Application - Visa Guide AIA</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Header -->
    <header class="main-header">
        <div class="header-container">
            <div class="logo-section">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    <path d="M9 12l2 2 4-4"/>
                </svg>
                <h1>Visa Guide AIA</h1>
            </div>
            
            <nav class="main-nav">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="forms.html" class="nav-link active">New Application</a>
            </nav>
            
            <div class="user-section">
                <div class="user-info">
                    <span id="user-name">Welcome, User</span>
                    <button id="logout-btn" class="btn btn-outline">Logout</button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="content-container">
            <div class="page-header">
                <h2>New Visa Application</h2>
                <a href="dashboard.html" class="btn btn-outline">Back to Dashboard</a>
            </div>
            
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <span>Destination & Type</span>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <span>Personal Information</span>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <span>Passport Details</span>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <span>Travel Information</span>
                </div>
            </div>
            
            <!-- Application Form -->
            <form id="application-form" class="application-form">
                <!-- Step 1: Destination & Visa Type -->
                <section class="form-section active" id="section-step-1">
                    <h3>Destination & Visa Type</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destination">Country of Destination *</label>
                            <select id="destination" name="destination" required>
                                <option value="">Select a country</option>
                                <option value="United States">United States</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Canada">Canada</option>
                                <option value="Australia">Australia</option>
                                <option value="Germany">Germany</option>
                                <option value="France">France</option>
                                <option value="Japan">Japan</option>
                                <option value="Singapore">Singapore</option>
                                <option value="UAE">United Arab Emirates</option>
                                <option value="China">China</option>
                                <option value="India">India</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="New Zealand">New Zealand</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="Italy">Italy</option>
                                <option value="Spain">Spain</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Norway">Norway</option>
                                <option value="Denmark">Denmark</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="visa-type">Visa Type *</label>
                            <select id="visa-type" name="visaType" required>
                                <option value="">Select visa type</option>
                                <option value="Tourist">Tourist Visa</option>
                                <option value="Business">Business Visa</option>
                                <option value="Student">Student Visa</option>
                                <option value="Work">Work Visa</option>
                                <option value="Transit">Transit Visa</option>
                                <option value="Family">Family Visa</option>
                                <option value="Medical">Medical Visa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="purpose">Purpose of Visit *</label>
                        <textarea id="purpose" name="purpose" rows="4" placeholder="Please describe the purpose of your visit..." required></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="nextStep(1)">Next Step</button>
                    </div>
                </section>
                
                <!-- Step 2: Personal Information -->
                <section class="form-section" id="section-step-2">
                    <h3>Personal Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="full-name">Full Name (as per passport) *</label>
                            <input type="text" id="full-name" name="fullName" placeholder="Enter your full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" placeholder="Enter your email" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="nationality">Nationality *</label>
                            <select id="nationality" name="nationality" required>
                                <option value="">Select nationality</option>
                                <option value="Afghanistan">Afghanistan</option>
                                <option value="Albania">Albania</option>
                                <option value="Algeria">Algeria</option>
                                <option value="Argentina">Argentina</option>
                                <option value="Australia">Australia</option>
                                <option value="Austria">Austria</option>
                                <option value="Bahrain">Bahrain</option>
                                <option value="Bangladesh">Bangladesh</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Brazil">Brazil</option>
                                <option value="Canada">Canada</option>
                                <option value="China">China</option>
                                <option value="Colombia">Colombia</option>
                                <option value="Egypt">Egypt</option>
                                <option value="France">France</option>
                                <option value="Germany">Germany</option>
                                <option value="Greece">Greece</option>
                                <option value="India">India</option>
                                <option value="Indonesia">Indonesia</option>
                                <option value="Iran">Iran</option>
                                <option value="Iraq">Iraq</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Italy">Italy</option>
                                <option value="Japan">Japan</option>
                                <option value="Jordan">Jordan</option>
                                <option value="Kuwait">Kuwait</option>
                                <option value="Lebanon">Lebanon</option>
                                <option value="Libya">Libya</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Morocco">Morocco</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="New Zealand">New Zealand</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="Norway">Norway</option>
                                <option value="Oman">Oman</option>
                                <option value="Pakistan">Pakistan</option>
                                <option value="Palestine">Palestine</option>
                                <option value="Philippines">Philippines</option>
                                <option value="Poland">Poland</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Qatar">Qatar</option>
                                <option value="Russia">Russia</option>
                                <option value="Saudi Arabia">Saudi Arabia</option>
                                <option value="Singapore">Singapore</option>
                                <option value="South Africa">South Africa</option>
                                <option value="South Korea">South Korea</option>
                                <option value="Spain">Spain</option>
                                <option value="Sri Lanka">Sri Lanka</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="Syria">Syria</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Tunisia">Tunisia</option>
                                <option value="Turkey">Turkey</option>
                                <option value="UAE">United Arab Emirates</option>
                                <option value="UK">United Kingdom</option>
                                <option value="USA">United States</option>
                                <option value="Vietnam">Vietnam</option>
                                <option value="Yemen">Yemen</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="current-location">Current Location (City, Country) *</label>
                        <input type="text" id="current-location" name="currentLocation" placeholder="Enter your current location" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(2)">Previous</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next Step</button>
                    </div>
                </section>
                
                <!-- Step 3: Passport Details -->
                <section class="form-section" id="section-step-3">
                    <h3>Passport Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="passport-number">Passport Number *</label>
                            <input type="text" id="passport-number" name="passportNumber" placeholder="Enter passport number" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="passport-expiry">Passport Expiry Date *</label>
                            <input type="date" id="passport-expiry" name="passportExpiry" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="passport-issue">Place of Passport Issue *</label>
                        <input type="text" id="passport-issue" name="passportIssue" placeholder="Enter the city and country where passport was issued" required>
                    </div>
                    
                    <div class="info-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <p>Please ensure your passport is valid for at least 6 months from your intended date of travel.</p>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(3)">Previous</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next Step</button>
                    </div>
                </section>
                
                <!-- Step 4: Travel Information -->
                <section class="form-section" id="section-step-4">
                    <h3>Travel Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="departure-date">Intended Departure Date *</label>
                            <input type="date" id="departure-date" name="departureDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="return-date">Intended Return Date *</label>
                            <input type="date" id="return-date" name="returnDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="entry-port">Port of Entry *</label>
                            <input type="text" id="entry-port" name="entryPort" placeholder="Enter airport or border crossing name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="accommodation">Accommodation Type *</label>
                            <select id="accommodation" name="accommodation" required>
                                <option value="">Select accommodation type</option>
                                <option value="Hotel">Hotel</option>
                                <option value="Hostel">Hostel</option>
                                <option value="Apartment">Apartment</option>
                                <option value="Resort">Resort</option>
                                <option value="Friend/Family">Friend/Family House</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="accommodation-address">Accommodation Address (if known)</label>
                        <textarea id="accommodation-address" name="accommodationAddress" rows="2" placeholder="Enter the address where you will be staying"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="terms-agreement" name="termsAgreement" required>
                            I declare that the information provided above is true and accurate to the best of my knowledge. *
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(4)">Previous</button>
                        <button type="submit" class="btn btn-primary">Submit Application</button>
                    </div>
                </section>
            </form>
        </div>
    </main>
    
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = Storage.getCurrentUser();
            
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            
            // Update user name
            const userName = document.getElementById('user-name');
            if (currentUser.name) {
                userName.textContent = 'Welcome, ' + currentUser.name;
            } else if (currentUser.profile && currentUser.profile.fullName) {
                userName.textContent = 'Welcome, ' + currentUser.profile.fullName;
            }
            
            // Pre-fill email from user profile
            if (currentUser.email) {
                document.getElementById('email').value = currentUser.email;
            }
            
            // Set minimum date for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('departure-date').min = today;
            document.getElementById('passport-expiry').min = today;
            
            // Update return date minimum when departure date changes
            document.getElementById('departure-date').addEventListener('change', function() {
                document.getElementById('return-date').min = this.value;
            });
        });
        
        // Form navigation
        function nextStep(currentStep) {
            // Validate current step
            const currentSection = document.getElementById('section-step-' + currentStep);
            const inputs = currentSection.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.style.borderColor = '#e74c3c';
                } else {
                    input.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Move to next step
            document.getElementById('section-step-' + currentStep).classList.remove('active');
            document.getElementById('section-step-' + (currentStep + 1)).classList.add('active');
            
            // Update progress
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
            document.querySelector(`.step[data-step="${currentStep + 1}"]`).classList.add('active');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevStep(currentStep) {
            document.getElementById('section-step-' + currentStep).classList.remove('active');
            document.getElementById('section-step-' + (currentStep - 1)).classList.add('active');
            
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep - 1}"]`).classList.remove('completed');
            document.querySelector(`.step[data-step="${currentStep - 1}"]`).classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Form submission
        document.getElementById('application-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentUser = Storage.getCurrentUser();
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            
            // Collect form data
            const formData = {
                destination: document.getElementById('destination').value,
                visaType: document.getElementById('visa-type').value,
                purpose: document.getElementById('purpose').value,
                fullName: document.getElementById('full-name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                nationality: document.getElementById('nationality').value,
                currentLocation: document.getElementById('current-location').value,
                passportNumber: document.getElementById('passport-number').value,
                passportExpiry: document.getElementById('passport-expiry').value,
                passportIssue: document.getElementById('passport-issue').value,
                departureDate: document.getElementById('departure-date').value,
                returnDate: document.getElementById('return-date').value,
                entryPort: document.getElementById('entry-port').value,
                accommodation: document.getElementById('accommodation').value,
                accommodationAddress: document.getElementById('accommodation-address').value
            };
            
            // Save application
            const result = Storage.addApplication(currentUser.id, formData);
            
            if (result.success) {
                showNotification('Application submitted successfully!', 'success');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            } else {
                showNotification('Error submitting application: ' + result.message, 'error');
            }
        });
        
        // Remove error styling on input
        document.querySelectorAll('input[required], select[required], textarea[required]').forEach(input => {
            input.addEventListener('input', function() {
                this.style.borderColor = '';
            });
        });
    </script>
</body>
</html>
